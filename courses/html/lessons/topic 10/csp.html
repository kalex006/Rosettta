<header class="lesson-header">
    <h1 class="artifact-title">10.4 Content Security Policy (CSP)</h1>
    <p class="artifact-subtitle">The Defensive Perimeter: Implementing declarative security barriers to mitigate injection attacks.</p>
</header>

<section class="lesson-content">
    
    <div class="content-block">
        <h2>The Browser Firewall</h2>
        <p>
            In the ROSETTA <strong>Zero-Backend</strong> model, the browser is our only line of defense. <strong>Content Security Policy (CSP)</strong> is a powerful security layer that allows architects to restrict the resources (such as JavaScript, CSS, Images) that the browser is allowed to load for a specific page.
        </p>
        <p>
            By defining a strict CSP, you effectively neutralize <strong>Cross-Site Scripting (XSS)</strong>. Even if an attacker manages to inject a malicious <code>&lt;script&gt;</code> tag into your document, the browser will refuse to execute it because it is not on the "Whitelist."
        </p>
    </div>

    <div class="content-block">
        <h2>1. Implementation: Meta vs. Header</h2>
        <p>
            Ideally, CSP is delivered via an HTTP Header from the server. however, since ROSETTA is hosted on <strong>GitHub Pages</strong> (Static Hosting), we implement our policy using the <code>&lt;meta&gt;</code> tag located in the document <code>&lt;head&gt;</code>.
        </p>
    </div>

    <div class="code-artifact">
        <div class="code-header">
            <span class="lang-tag">HTML</span>
            <span class="file-name">csp_meta_tag.html</span>
        </div>
        <pre><code class="language-html">&lt;head&gt;
    &lt;meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; script-src 'self' https://apis.google.com;"&gt;
&lt;/head&gt;</code></pre>
    </div>

    <div class="content-block">
        <h2>2. Core Directives</h2>
        <p>
            A policy is composed of several "Directives" that control different resource types:
        </p>
        <table class="artifact-table">
            <thead>
                <tr>
                    <th>Directive</th>
                    <th>Governs</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>default-src</code></td>
                    <td>The fallback for all other directives. Usually set to <code>'self'</code>.</td>
                </tr>
                <tr>
                    <td><code>script-src</code></td>
                    <td>Defines valid sources for JavaScript.</td>
                </tr>
                <tr>
                    <td><code>style-src</code></td>
                    <td>Defines valid sources for CSS stylesheets.</td>
                </tr>
                <tr>
                    <td><code>img-src</code></td>
                    <td>Defines valid sources for images and favicons.</td>
                </tr>
                <tr>
                    <td><code>frame-ancestors</code></td>
                    <td>Prevents other sites from embedding ROSETTA in an iframe (Clickjacking protection).</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="content-block">
        <h2>3. The 'Self' and 'None' Keywords</h2>
        <ul class="artifact-list">
            <li><strong>'self'</strong>: Allows resources from the same origin (same domain, same port, same protocol).</li>
            <li><strong>'none'</strong>: Blocks everything for that category.</li>
            <li><strong>'unsafe-inline'</strong>: Allows inline <code>&lt;script&gt;</code> or <code>&lt;style&gt;</code> tags. <strong>Architect's Warning:</strong> Using this largely defeats the purpose of CSP. Avoid it at all costs.</li>
        </ul>
    </div>

    <div class="content-block">
        <h2>4. Advanced Trust: Nonces and Hashes</h2>
        <p>
            If you <em>must</em> use an inline script for a specific logic fragment, you can whitelist that specific script without allowing all inline scripts. You do this using a <strong>Hash</strong> or a <strong>Nonce</strong> (Number used once).
        </p>
    </div>

    <div class="code-artifact">
        <div class="code-header">
            <span class="lang-tag">HTML</span>
            <span class="file-name">hash_whitelist.html</span>
        </div>
        <pre><code class="language-html">&lt;!-- 
  The browser will calculate the SHA-256 hash of the script. 
  If the hash matches the one in the CSP, the script runs.
--&gt;
&lt;meta http-equiv="Content-Security-Policy" 
      content="script-src 'sha256-xyz123...';"&gt;

&lt;script&gt;
    console.log("This specific script is trusted.");
&lt;/script&gt;</code></pre>
    </div>

    <div class="alert-box gold">
        <span class="alert-icon">⚡</span>
        <div class="alert-content">
            <strong>Architect's Security Strategy:</strong> For PROJECT ROSETTA, we recommend the <strong>Strict Policy</strong>:
            <code>default-src 'none'; script-src 'self'; style-src 'self' https://fonts.googleapis.com; img-src 'self' data:; font-src 'self' https://fonts.gstatic.com; connect-src 'self';</code>
            This blocks everything by default and only opens "holes" for our local files and Google Fonts.
        </div>
    </div>

    <div class="content-block">
        <h2>5. The Reporting Layer</h2>
        <p>
            When a policy is violated, the browser blocks the resource and logs an error in the console. In a production environment, you can use the <code>report-to</code> directive to send a JSON report to a specific URL so you can monitor attacks or broken assets in real-time.
        </p>
    </div>

    <div class="alert-box gold">
        <span class="alert-icon">⚠</span>
        <div class="alert-content">
            <strong>Critical Constraint:</strong> Meta tags do not support the <code>frame-ancestors</code>, <code>report-uri</code>, or <code>sandbox</code> directives. Those must be set via HTTP headers if you migrate ROSETTA to a dedicated server in the future.
        </div>
    </div>

</section>